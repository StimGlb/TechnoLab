<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNB Technologie - Trottinette √âlectrique</title>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>

    </style>
</head>
<body>
    <div class="container">

    </div>

    <script>

        // Protection par mot de passe
        (function() {
            const MOT_DE_PASSE = 'dev'; // ‚Üê Changez ici
            let tentatives = 3;

            while (tentatives > 0) {
                const saisie = prompt('üîí Mot de passe requis pour acc√©der au formulaire :');

                if (saisie === null) {
                    document.body.innerHTML = '<h1 style="text-align:center;margin-top:50px;">‚ùå Acc√®s annul√©</h1>';
                    throw new Error('Acc√®s annul√©');
                }

                if (saisie === MOT_DE_PASSE) {
                    return; // ‚úÖ Mot de passe correct
                }

                tentatives--;
                if (tentatives > 0) {
                    alert('‚ùå Mot de passe incorrect ! Il vous reste ' + tentatives + ' tentative(s).');
                }
            }

            alert('üö´ Nombre de tentatives d√©pass√© !');
            document.body.innerHTML = '<h1 style="text-align:center;margin-top:50px;">‚ùå Acc√®s refus√©</h1>';
            throw new Error('Acc√®s refus√©');
        })();

        // ============================================
        // CONFIRMATION AVANT FERMETURE
        // ============================================
        let formModified = false;

        document.getElementById('dnbForm').addEventListener('input', function() {
            formModified = true;
        });

        window.addEventListener('beforeunload', function(e) {
            if (formModified) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            }
        });

        // ============================================
        // CONFIGURATION FIREBASE
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyDIvzEk0xKVdRC0r9D_tBGnKPX29Fqkem4",
            authDomain: "form-results-b285b.firebaseapp.com",
            projectId: "form-results-b285b",
            storageBucket: "form-results-b285b.firebasestorage.app",
            messagingSenderId: "662462446647",
            appId: "1:662462446647:web:0fe6315cc0c189185513b2"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        console.log('‚úÖ Firebase initialis√©');

        // ============================================
        // BOUTON D'ENVOI
        // ============================================
        document.getElementById('sendToFirebase').addEventListener('click', async function() {
            const form = document.getElementById('dnbForm');

            // V√©rifier la validit√© du formulaire
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // D√©sactiver le bouton
            const originalText = this.textContent;
            this.disabled = true;
            this.textContent = '‚è≥ Envoi en cours...';

            try {
                // Collecter les donn√©es
                const formData = new FormData(form);

                const responses = {
                    nom_eleve: document.getElementById('studentName').value,
                    classe: document.getElementById('studentClass').value,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    date_soumission: new Date().toISOString(),
                    
                };

                console.log('üì§ Envoi des donn√©es:', responses);

                // Envoyer √† Firebase
                const docRef = await db.collection('dnb_trottinette').add(responses);

                console.log('‚úÖ Document enregistr√© avec ID:', docRef.id);

                // R√©activer le bouton
                this.disabled = false;
                this.textContent = originalText;

                // Notification de succ√®s
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });

                // R√©initialiser le formulaire apr√®s 2 secondes
                setTimeout(() => {
                    form.reset();
                    formModified = false;
                    document.getElementById('result').style.display = 'none';
                }, 3000);

            } catch (error) {
                console.error('‚ùå Erreur Firebase:', error);

                // R√©activer le bouton
                this.disabled = false;
                this.textContent = originalText;

                // Notification d'erreur
                alert('‚ùå Erreur lors de l\'envoi : ' + error.message);
            }
        });

        // Gestion du bouton de r√©initialisation
        document.getElementById('dnbForm').addEventListener('reset', function() {
            if (confirm('√ätes-vous s√ªr de vouloir effacer toutes vos r√©ponses ?')) {
                formModified = false;
                document.getElementById('result').style.display = 'none';
            } else {
                return false;
            }
        });
    </script>
</body>
</html>
